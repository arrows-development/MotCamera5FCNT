precision mediump float;
varying vec2 v_Position;
varying highp vec2 v_TextureCoord;
uniform int u_UseTexture;
uniform vec4 u_Color;
uniform float u_Opacity;
uniform float u_Radius;
uniform float u_LineWidth;
uniform vec2 u_Size;
uniform vec4 u_ColorBackground;
uniform sampler2D u_Texture;

float udRoundRect(vec2 p, vec2 b, float r)
{
    return length(max(abs(p) - b, 0.0)) - r;
}

void main() {
    vec2 pos = v_Position;
    float rad = u_Radius;
    vec4 v_Color = u_Color;

    float line = u_LineWidth;
    vec2 size = u_Size ;
    float alpha = 0.0;

    float dis = udRoundRect(pos, size - rad, rad);
    vec4 sample = texture2D(u_Texture, v_TextureCoord);

    if(u_UseTexture == 1) {
        v_Color = sample * u_Opacity;
    } else {
        v_Color = vec4(v_Color.rgb * v_Color.a, v_Color.a) * u_Opacity;
    }

    if (u_LineWidth >= 0.001 && dis <= -line) {
        alpha = clamp(abs(dis + line), 0.0, 1.0);//stroke
        gl_FragColor = mix(v_Color, u_ColorBackground * u_ColorBackground.a * u_Opacity, alpha);
    } else {
        alpha = clamp(dis, 0.0, 1.0);//solid
        gl_FragColor = mix(v_Color, vec4(0.0, 0.0, 0.0, 0.0), alpha);
    }
}